<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>è®¢é˜… & GitHub é“¾æ¥è½¬æ¢å™¨</title>
</head>

<body>
<h1>è®¢é˜… / GitHub é“¾æ¥è½¬æ¢å™¨</h1>

<textarea id="input" placeholder="ç²˜è´´è®¢é˜…é“¾æ¥æˆ– GitHub é“¾æ¥"></textarea>

<div class="buttons">
  <button id="convert">âœ¨ æ™ºèƒ½è½¬æ¢</button>
  <button id="actionBtn">ğŸ—‘ï¸ æ¸…ç©º</button>
</div>

<div id="resultGroup"></div>

<script>
const input = document.getElementById('input');
const resultGroup = document.getElementById('resultGroup');
const convertBtn = document.getElementById('convert');
const actionBtn = document.getElementById('actionBtn');

/* ========= è®¢é˜…é“¾æ¥é‡å†™ ========= */
function rewriteSubscriptionUrl(url) {
  try {
    const u = new URL(url);
    return 'https://xinote.site:8443' + u.pathname + u.search;
  } catch {
    return null;
  }
}

/* ========= è½¬æ¢å…¥å£ ========= */
function convert() {
  const urls = input.value.split('\n').map(v => v.trim()).filter(Boolean);
  if (!urls.length) return alert('è¯·è¾“å…¥é“¾æ¥');

  // ===== è®¢é˜…é“¾æ¥ä¼˜å…ˆ =====
  if (urls.length === 1) {
    const rewritten = rewriteSubscriptionUrl(urls[0]);
    if (rewritten) {
      resultGroup.innerHTML = `
        <div class="card">
          <div class="label">ğŸ” è®¢é˜…é“¾æ¥å·²é‡å†™</div>
          <div class="url">${rewritten}</div>
          <button class="copy" data-url="${rewritten}">ğŸ“‹ å¤åˆ¶</button>
        </div>`;
      return;
    }
  }

  alert('è¿™é‡Œåªæ¼”ç¤ºè®¢é˜…é“¾æ¥é‡å†™ï¼ŒGitHub åŠŸèƒ½ä½ åŸæ¥çš„ä»£ç å¯ç›´æ¥åˆå¹¶');
}

function reset() {
  input.value = '';
  resultGroup.innerHTML = '';
}

resultGroup.addEventListener('click', e => {
  if (e.target.classList.contains('copy')) {
    navigator.clipboard.writeText(e.target.dataset.url);
    e.target.innerText = 'âœ… å·²å¤åˆ¶';
    setTimeout(() => e.target.innerText = 'ğŸ“‹ å¤åˆ¶', 1200);
  }
});

convertBtn.onclick = convert;
actionBtn.onclick = reset;
</script>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f5f7fb;
  max-width: 720px;
  margin: auto;
  padding: 20px;
}
h1 { text-align: center; }
textarea {
  width: 100%;
  height: 120px;
  padding: 14px;
  border-radius: 12px;
  border: 1px solid #ccc;
}
.buttons {
  display: flex;
  gap: 10px;
  margin: 15px 0;
}
button {
  flex: 1;
  padding: 12px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
}
#convert { background: #007aff; color: #fff; }
#actionBtn { background: #ddd; }
.card {
  background: #fff;
  padding: 16px;
  border-radius: 14px;
  box-shadow: 0 6px 18px rgba(0,0,0,.1);
}
.label { font-weight: 600; margin-bottom: 8px; }
.url {
  font-family: monospace;
  word-break: break-all;
  color: #d63384;
  margin-bottom: 10px;
}
.copy {
  background: #34c759;
  color: white;
}
</style>

</body>
</html>
