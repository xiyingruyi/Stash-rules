<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>GitHub & è®¢é˜…åŠ é€Ÿå™¨</title>
  <meta name="description" content="æ”¯æŒ GitHub èµ„æºåŠè®¢é˜…é“¾æ¥è½¬æ¢ | æç®€ Â· è‹¹æœç¾å­¦" />
  <link rel="apple-touch-icon" sizes="180x180" href="https://fastly.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Rocket.png" />
  <link rel="icon" href="https://fastly.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Rocket.png" sizes="16x16" type="image/png">
  <style>
    /* ... æ­¤å¤„ä¿ç•™åŸæœ‰ CSS æ ·å¼ ... */
    :root {
      --bg: #f7f9fc; --card-bg: #ffffff; --text: #1c1e21; --text-light: #666;
      --border: #e1e5e9; --primary: #007aff; --shadow: 0 8px 30px rgba(0,0,0,0.12);
      --radius: 16px; --transition: all 0.2s ease; --url-color: #d63384;
      --ghfast-color: #ff9500;
      --sub-color: #5856d6; /* æ–°å¢è®¢é˜…é“¾æ¥é¢œè‰² */
    }
    @media (prefers-color-scheme: dark) {
      :root { --bg: #000; --card-bg: #1c1c1e; --text: #f1f1f3; --border: #3a3a3c; --url-color: #ff79c6; --ghfast-color: #ffb74d; }
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--text); max-width: 860px; margin: 0 auto; min-height: 100vh; display: flex; flex-direction: column; }
    h1 { text-align: center; margin: 32px 0 16px; }
    .subtitle { text-align: center; color: var(--text-light); margin-bottom: 24px; }
    .container { flex: 1; padding: 0 20px; display: flex; flex-direction: column; gap: 20px; }
    textarea { width: 100%; height: 140px; padding: 16px; border: 1px solid var(--border); border-radius: var(--radius); background: var(--card-bg); box-shadow: var(--shadow); color: var(--text); resize: vertical; }
    .tip { font-size: 0.9rem; color: var(--text-light); padding: 14px 20px; background: var(--card-bg); border: 1px solid var(--border); border-radius: var(--radius); }
    #resultGroup { display: none; margin-top: 10px; }
    .result-card { background: var(--card-bg); border: 1px solid var(--border); border-radius: var(--radius); padding: 16px; box-shadow: var(--shadow); margin-bottom: 20px; }
    .cdn-result, .ghfast-result, .sub-result { margin-top: 12px; padding-left: 12px; border-left: 2px solid var(--border); }
    .ghfast-result { border-left-color: var(--ghfast-color); }
    .sub-result { border-left-color: var(--sub-color); }
    .label { font-weight: 600; margin-bottom: 4px; }
    .result-url { font-family: monospace; color: var(--url-color); word-break: break-all; margin-bottom: 8px; }
    .hint { font-size: 0.85rem; color: var(--text-light); margin-bottom: 8px; }
    .copy-btn { background: var(--primary); color: #fff; border: none; padding: 6px 12px; border-radius: 8px; cursor: pointer; }
    .buttons { display: flex; gap: 12px; }
    button { flex: 1; padding: 14px; border-radius: var(--radius); border: none; font-weight: 500; cursor: pointer; }
    #convert { background: var(--primary); color: #fff; }
    #purgeBtn { background: #34c759; color: #fff; }
    #actionBtn { background: var(--border); color: var(--text); }
    footer { text-align: center; padding: 30px; font-size: 0.8rem; color: var(--text-light); }
  </style>
</head>
<body>
  <h1>èµ„æº & è®¢é˜…è½¬æ¢å™¨</h1>
  <p class="subtitle">æ”¯æŒ GitHub åŠ é€Ÿä¸æ—§è®¢é˜…é“¾æ¥è½¬æ¢</p>
  
  <div class="container">
    <textarea id="input" placeholder="ç²˜è´´é“¾æ¥...&#10;æ”¯æŒ GitHub é“¾æ¥æˆ–æ—§è®¢é˜…é“¾æ¥ (xinote.site:2096)"></textarea>
    
    <div class="tip">
      â€¢ <b>è®¢é˜…è½¬æ¢ï¼š</b>è‡ªåŠ¨å°† xinote.site:2096 æ›¿æ¢ä¸º https://xinote.site:8443<br>
      â€¢ <b>GitHub åŠ é€Ÿï¼š</b>æ”¯æŒ raw/blob è½¬ jsDelivr æˆ– ghfast.top ä»£ç†
    </div>

    <div id="resultGroup"></div>

    <div class="buttons">
      <button id="convert">âœ¨ æ™ºèƒ½è½¬æ¢</button>
      <button id="purgeBtn">ğŸ”„ åˆ·æ–°ç¼“å­˜</button>
      <button id="actionBtn">ğŸ—‘ï¸ æ¸…ç©º</button>
    </div>
  </div>

  <script>
    const input = document.getElementById('input');
    const resultGroup = document.getElementById('resultGroup');
    const convertBtn = document.getElementById('convert');
    const purgeBtn = document.getElementById('purgeBtn');
    const actionBtn = document.getElementById('actionBtn');

    // æ£€æŸ¥æ˜¯å¦ä¸ºæ—§è®¢é˜…é“¾æ¥
    function isOldSubUrl(url) {
        return url.includes('xinote.site:2096');
    }

    function isJsDelivrSupported(url) {
        try {
            const parsed = new URL(url);
            return parsed.hostname === 'raw.githubusercontent.com' || 
                   (parsed.hostname === 'github.com' && (/\/raw\//.test(parsed.pathname) || /\/blob\//.test(parsed.pathname)));
        } catch { return false; }
    }

    function isGhfastSupported(url) {
        try {
            const parsed = new URL(url);
            return parsed.hostname.includes('github') || parsed.hostname.endsWith('.github.io');
        } catch { return false; }
    }

    function generateUrls(inputUrl) {
        let results = [];

        // --- é€»è¾‘ï¼šå¤„ç†è®¢é˜…é“¾æ¥è½¬æ¢ ---
        if (isOldSubUrl(inputUrl)) {
            try {
                const urlObj = new URL(inputUrl);
                // æ‹¼æ¥æ–°å‰ç¼€ + è·¯å¾„ + å‚æ•°
                const newSubUrl = `https://xinote.site:8443${urlObj.pathname}${urlObj.search}`;
                results.push({
                    label: 'ğŸš€ æ–°è®¢é˜…é“¾æ¥ (8443)',
                    url: newSubUrl,
                    hint: 'å·²è‡ªåŠ¨æ›¿æ¢æ—§åŸŸåå’Œç«¯å£',
                    type: 'sub'
                });
            } catch (e) {
                // å¦‚æœ URL æ„é€ å¤±è´¥ï¼Œå°è¯•å­—ç¬¦ä¸²ç®€å•æ›¿æ¢
                const replaced = inputUrl.replace(/http:\/\/xinote\.site:2096/, 'https://xinote.site:8443');
                results.push({ label: 'ğŸš€ æ–°è®¢é˜…é“¾æ¥ (8443)', url: replaced, hint: 'å·²è‡ªåŠ¨æ›¿æ¢æ—§ç«¯å£', type: 'sub' });
            }
        }

        // --- é€»è¾‘ï¼šGitHub åŸæœ‰åŠ é€Ÿé€»è¾‘ ---
        if (isJsDelivrSupported(inputUrl)) {
            const parts = parseGitHubParts(inputUrl);
            if (parts) {
                const base = `${parts.user}/${parts.repo}@${parts.ref}/${parts.filePathArr.join('/')}`;
                results.push(
                    { label: 'âœ… ğŸ‡¨ğŸ‡³ JsdMirror', url: `https://cdn.jsdmirror.com/gh/${base}`, hint: 'å›½å†…é•œåƒ', type: 'cdn' },
                    { label: 'ğŸŒ jsDelivr', url: `https://cdn.jsdelivr.net/gh/${base}`, hint: 'å…¨çƒåŠ é€Ÿ', type: 'cdn' }
                );
            }
        }

        if (isGhfastSupported(inputUrl)) {
            results.push({ label: 'ğŸ”¥ ghfast.top', url: `https://ghfast.top/${inputUrl}`, hint: 'ä»£ç†åŠ é€Ÿ', type: 'ghfast' });
        }

        return results;
    }

    function parseGitHubParts(url) {
        try {
            const parsed = new URL(url);
            let pathname = parsed.pathname;
            if (parsed.hostname === 'github.com') {
                pathname = pathname.replace('/raw/', '/').replace('/blob/', '/').replace('/refs/heads/', '/');
            }
            const parts = pathname.slice(1).split('/');
            if (parts.length < 4) return null;
            return { user: parts[0], repo: parts[1], ref: parts[2], filePathArr: parts.slice(3) };
        } catch { return null; }
    }

    function convert() {
        const urls = input.value.split('\n').map(u => u.trim()).filter(u => u);
        if (!urls.length) return alert('è¯·è¾“å…¥å†…å®¹');
        
        resultGroup.innerHTML = '';
        urls.forEach((url, idx) => {
            const results = generateUrls(url);
            if (results.length > 0) {
                const card = document.createElement('div');
                card.className = 'result-card';
                let html = urls.length > 1 ? `<div class="label">é¡¹ç›® ${idx + 1}</div>` : '';
                results.forEach(item => {
                    html += `
                        <div class="${item.type}-result">
                            <div class="label">${item.label}</div>
                            <div class="result-url">${item.url}</div>
                            <div class="hint">${item.hint}</div>
                            <button class="copy-btn" data-url="${item.url}">ğŸ“‹ å¤åˆ¶</button>
                        </div>`;
                });
                card.innerHTML = html;
                resultGroup.appendChild(card);
            }
        });
        resultGroup.style.display = 'block';
        actionBtn.textContent = 'â†º é‡ç½®';
    }

    // å¤åˆ¶å’Œé‡ç½®é€»è¾‘
    resultGroup.addEventListener('click', e => {
        const btn = e.target.closest('.copy-btn');
        if (!btn) return;
        navigator.clipboard.writeText(btn.dataset.url).then(() => {
            const old = btn.textContent;
            btn.textContent = 'âœ… å·²å¤åˆ¶';
            setTimeout(() => btn.textContent = old, 1500);
        });
    });

    actionBtn.addEventListener('click', () => {
        input.value = '';
        resultGroup.innerHTML = '';
        resultGroup.style.display = 'none';
        actionBtn.textContent = 'ğŸ—‘ï¸ æ¸…ç©º';
    });

    convertBtn.addEventListener('click', convert);
  </script>
</body>
</html>
