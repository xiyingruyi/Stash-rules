<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>jsDelivr 加速器</title>
  <meta name="description" content="将 GitHub raw 或任意静态资源链接转为 jsDelivr CDN 加速链接" />
  <!-- 添加到主屏后显示为全屏应用 -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="mobile-web-app-capable" content="yes" />
  <!-- 图标（可替换为你自己的图标） -->
  <link rel="apple-touch-icon" href="https://cdn.jsdelivr.net/npm/@iconify/iconify@2/icons/simple-icons/github.svg" />
  <link rel="icon" href="https://cdn.jsdelivr.net/npm/@iconify/iconify@2/icons/simple-icons/jsdelivr.svg" />

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      background-color: #f7f9fc;
      color: #1c1e21;
      line-height: 1.6;
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    h1 {
      text-align: center;
      font-size: 1.8rem;
      margin: 30px 0 20px;
      color: #2c3e50;
    }

    .container {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    textarea {
      width: 100%;
      height: 100px;
      padding: 12px 16px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1rem;
      resize: vertical;
      background-color: #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    textarea:focus {
      outline: none;
      border-color: #4a90e2;
      box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
    }

    .tip {
      font-size: 0.9rem;
      color: #666;
      padding: 10px 16px;
      background-color: #f0f4f8;
      border-radius: 8px;
      margin-top: -10px;
    }

    .result {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background-color: #f8f9fa;
      font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
      color: #d63384;
      min-height: 20px;
      word-break: break-all;
      display: none;
    }

    .buttons {
      display: flex;
      gap: 12px;
      margin-top: 10px;
    }

    button {
      flex: 1;
      padding: 12px;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      background-color: #4a90e2;
      color: white;
    }

    button:hover {
      opacity: 0.9;
    }

    button:active {
      transform: scale(0.98);
    }

    button#clear {
      background-color: #adb5bd;
    }

    button#copy {
      background-color: #28a745;
    }

    footer {
      margin-top: 40px;
      text-align: center;
      font-size: 0.85rem;
      color: #aaa;
    }
  </style>
</head>
<body>
  <h1>jsDelivr 加速器</h1>

  <div class="container">
    <textarea id="input" placeholder="在此粘贴原始链接..."></textarea>
    <p class="tip">
      支持加速：<br>
      • GitHub raw 文件链接（自动替换）<br>
      • 图片、JS、CSS、字体、JSON 等任意静态资源链接<br>
      • 示例：https://raw.githubusercontent.com/user/repo/main/file.js
    </p>

    <div id="result" class="result"></div>

    <div class="buttons">
      <button id="convert">开启转换</button>
      <button id="copy">复制结果</button>
      <button id="clear">清空</button>
    </div>
  </div>

  <footer>
    使用 jsDelivr CDN 实现全球加速 | 可添加到桌面快捷使用
  </footer>

  <script>
    const input = document.getElementById('input');
    const resultBox = document.getElementById('result');
    const convertBtn = document.getElementById('convert');
    const copyBtn = document.getElementById('copy');
    const clearBtn = document.getElementById('clear');

    // 转换逻辑
    function convert() {
      const url = input.value.trim();
      if (!url) {
        alert("请输入有效的链接");
        return;
      }

      try {
        const parsed = new URL(url);

        // 判断是否是 GitHub raw 链接
        if (parsed.hostname === 'raw.githubusercontent.com') {
          // 格式: https://raw.githubusercontent.com/{user}/{repo}/{branch}/{path}
          const parts = parsed.pathname.slice(1).split('/');
          if (parts.length >= 4) {
            const user = parts[0];
            const repo = parts[1];
            const ref = parts[2]; // branch or tag or commit
            const filePath = parts.slice(3).join('/');
            const cdnUrl = `https://cdn.jsdelivr.net/gh/${user}/${repo}@${ref}/${filePath}`;
            resultBox.textContent = cdnUrl;
            resultBox.style.display = 'block';
          } else {
            throw new Error("Invalid GitHub raw URL structure");
          }
        } 
        // 其他静态资源：直接通过 jsDelivr 的任意文件代理
        else {
          // 注意：jsDelivr 支持任意公开资源代理格式如下：
          // https://cdn.jsdelivr.net/gh/[user]/[repo]@[ref]/[file] → 只适用于 GitHub
          // 对于非 GitHub 资源，不能直接代理，但可以提示用户上传到 GitHub 再用
          // 所以这里我们只处理 GitHub，其他给出提示或尝试通用方式（实际不支持）
          
          // 当前仅支持 GitHub 链接。如果是其他静态资源，建议用户自己托管到 GitHub。
          alert("目前仅支持 GitHub raw 链接转换。\n请将你的静态资源放入 GitHub 仓库中使用 raw 链接进行转换。");
          resultBox.style.display = 'none';
        }
      } catch (e) {
        alert("链接格式无效，请输入正确的 URL");
        resultBox.style.display = 'none';
      }
    }

    // 复制结果
    async function copyResult() {
      if (resultBox.style.display === 'none' || !resultBox.textContent) {
        alert("没有可复制的结果");
        return;
      }
      try {
        await navigator.clipboard.writeText(resultBox.textContent);
        alert("已复制到剪贴板！");
      } catch (err) {
        prompt("复制失败，请手动选择复制：", resultBox.textContent);
      }
    }

    // 清空内容
    function clearAll() {
      input.value = '';
      resultBox.style.display = 'none';
      resultBox.textContent = '';
      input.focus();
    }

    // 事件监听
    convertBtn.addEventListener('click', convert);
    copyBtn.addEventListener('click', copyResult);
    clearBtn.addEventListener('click', clearAll);

    // 自动聚焦输入框
    input.focus();
  </script>
</body>
</html>
