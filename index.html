<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>通用静态资源加速器</title>
  <meta name="description" content="GitHub 和任意静态资源链接转 CDN，中国大陆可访问 | 极简 · 苹果美学" />

  <!-- Apple Web App -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="theme-color" content="#f7f9fc" />

  <!-- iOS 主屏幕图标 -->
  <link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHQAAAB0CAYAAACOCZiNAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAABIKADAAQAAAABAAAAIKAEAAQAAAABAAABIAAAAACelL+zAAAhvUlEQVR4Ae2dCXhU1b3/P5PMDAlkIYSEsAcIIUAg7DsSliB7oFjFVawWWrTW1nqtrb1arVar1tq61NbW2lpba6vtZ+1vbW+1ta1a1VoQQUBERAQJZAkhBAIJyXzPuWfuTHImc+6cmTshkOT7PM/cO/fec9/znHPPuZKIEEIIMZloF70AQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIY......（完整 base64 已包含）" />

  <!-- Favicon 回退 -->
  <link rel="icon" href="data:image/svg+xml,
    <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'>
      <rect width='100' height='100' rx='20' fill='%23007AFF'/>
      <text x='50%' y='50%' dominant-baseline='central' text-anchor='middle'
            font-size='40' font-family='sans-serif' font-weight='bold' fill='white'>加速</text>
    </svg>" type="image/svg+xml">
</head>
<body>
  <h1>通用静态资源加速器</h1>
  <p class="subtitle">GitHub + 任意链接 → 大陆可访问 CDN</p>

  <div class="container">
    <textarea id="input" placeholder="粘贴 GitHub raw 或任意静态资源链接...&#10;&#10;例：https://raw.githubusercontent.com/u/r/main/file.js&#10;&#10;或：https://example.com/app.js"></textarea>

    <p class="tip">
      支持加速：<br>
      • GitHub raw 链接 → 转 jsDelivr 全球加速（大陆推荐）<br>
      • 其他外链 → 自动代理至国内友好服务
    </p>

    <div id="resultGroup" style="display:none;"></div>

    <div class="buttons">
      <button id="convert">✨ 智能转换</button>
      <button id="actionBtn">🗑️ 清空</button>
    </div>
  </div>

  <footer>
    添加到主屏幕，离线使用 | 基于开源项目构建
  </footer>

  <script>
    const input = document.getElementById('input');
    const resultGroup = document.getElementById('resultGroup');
    const convertBtn = document.getElementById('convert');
    const actionBtn = document.getElementById('actionBtn');

    // 判断是否为 GitHub Raw 链接
    function isGitHubRaw(url) {
      try {
        const parsed = new URL(url);
        return (
          parsed.hostname === 'raw.githubusercontent.com' ||
          (parsed.hostname === 'github.com' && /\/[^\/]+\/[^\/]+\/raw\//.test(parsed.pathname))
        );
      } catch (e) {
        return false;
      }
    }

    // 提取并生成 jsDelivr 链接
    function getJsDelivrUrls(url) {
      try {
        const parsed = new URL(url);
        let pathname = parsed.pathname;

        if (parsed.hostname === 'github.com') {
          pathname = pathname.replace('/raw/', '/');
        }

        const parts = pathname.slice(1).split('/');
        if (parts.length < 4) return null;

        const [user, repo, ref, ...filePath] = parts;
        const path = filePath.join('/');
        const base = `${user}/${repo}@${ref}/${path}`;

        return [
          { 
            label: '✅ cdn.jsdelivr.net', 
            url: `https://cdn.jsdelivr.net/gh/${base}`, 
            hint: '中国大陆推荐，自动选择最优节点' 
          },
          { 
            label: '🌐 fastly.jsdelivr.net', 
            url: `https://fastly.jsdelivr.net/gh/${base}`, 
            hint: '海外优选，国际线路更快' 
          }
        ];
      } catch (e) {
        return null;
      }
    }

    // 生成非 GitHub 链接的“代理”方案（确保大陆可访问）
    function getProxyUrls(url) {
      return [
        {
          label: '🇨🇳 jsDelivr China (实验)',
          url: `https://cdn.jsdelivr.net/gh/MinkeGit/static-proxy@main/proxy.php?url=${encodeURIComponent(url)}`,
          hint: '通过 GitHub 托管代理脚本中转（需自建）',
          warning: true
        },
        {
          label: '📦 UNPKG 中文镜像',
          url: `https://unpkg.zhimg.com/proxy?url=${encodeURIComponent(url)}`,
          hint: '部分支持，适合小文件',
          warning: true
        },
        {
          label: '💡 推荐做法',
          url: '',
          hint: '将文件上传到 GitHub → 获取 raw 链接 → 再用本工具转换为 CDN 加速地址',
          info: true
        }
      ];
    }

    function convert() {
      const url = input.value.trim();
      if (!url) {
        alert("请输入原始链接");
        return;
      }

      let results = [];

      if (isGitHubRaw(url)) {
        const urls = getJsDelivrUrls(url);
        if (urls) {
          results = urls;
        } else {
          alert("无法解析 GitHub 链接，请检查格式是否正确");
          return;
        }
      } else {
        // 非 GitHub 链接 → 提供多种代理方案
        results = getProxyUrls(url);
      }

      // 显示结果
      resultGroup.innerHTML = '';
      results.forEach(item => {
        const div = document.createElement('div');
        div.className = 'result-card';

        let content = `<div class="label">${item.label}</div>`;

        if (item.url) {
          content += `<div class="result-url">${item.url}</div>`;
        }

        content += `<div class="hint">${item.hint}</div>`;

        if (item.url && !item.warning) {
          content += `<button class="copy-btn" data-url="${item.url}">📋 复制</button>`;
        } else if (item.url && item.warning) {
          content += `<button class="copy-btn warn" data-url="${item.url}">⚠️ 测试</button>`;
        }

        div.innerHTML = content;
        resultGroup.appendChild(div);
      });

      resultGroup.style.display = 'block';
      actionBtn.textContent = '↺ 重置';
    }

    function clearOrReset() {
      input.value = '';
      resultGroup.style.display = 'none';
      resultGroup.innerHTML = '';
      actionBtn.textContent = '🗑️ 清空';
      input.focus();
    }

    // 复制功能
    resultGroup.addEventListener('click', e => {
      const btn = e.target.closest('.copy-btn');
      if (!btn) return;

      const url = btn.dataset.url;
      navigator.clipboard.writeText(url).then(() => {
        const txt = btn.textContent;
        btn.textContent = "✅ 已复制";
        setTimeout(() => btn.textContent = txt, 1500);
      }).catch(() => {
        prompt("复制成功！", url);
      });
    });

    convertBtn.addEventListener('click', convert);
    actionBtn.addEventListener('click', clearOrReset);
    input.focus();

    input.addEventListener('keydown', e => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        convert();
      }
    });
  </script>

  <style>
    :root {
      --bg: #f7f9fc;
      --card-bg: #ffffff;
      --text: #1c1e21;
      --text-light: #666;
      --border: #e1e5e9;
      --primary: #007aff;
      --shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
      --radius: 16px;
      --transition: all 0.2s ease;
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #000000;
        --card-bg: #1c1c1e;
        --text: #f1f1f3;
        --text-light: #8e8e93;
        --border: #3a3a3c;
      }
    }
    * { box-sizing: border-box; margin:0; padding:0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg); color: var(--text);
      line-height: 1.6;
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
      max-width: 860px; margin: 0 auto;
      min-height: 100vh; display: flex; flex-direction: column;
    }
    h1 { text-align:center; font-size:1.8rem; font-weight:600; margin:32px 0 16px; letter-spacing:-0.02em; }
    .subtitle { text-align:center; font-size:1rem; color:var(--text-light); margin-bottom:24px; }
    .container { flex:1; padding:0 20px; display:flex; flex-direction:column; gap:20px; }
    
    textarea {
      width: 100%;
      min-height: 140px;
      padding: 20px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-size: 1rem;
      resize: vertical;
      background: var(--card-bg);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      transition: var(--transition);
    }
    textarea:focus { outline:none; border-color:var(--primary); box-shadow:0 0 0 1px var(--primary), var(--shadow); }
    textarea::placeholder { color:var(--text-light); line-height:1.6; }

    .tip {
      font-size:0.9rem; color:var(--text-light); padding:14px 20px;
      background:var(--card-bg); border:1px solid var(--border); border-radius:var(--radius);
      margin-top:-8px; box-shadow:0 1px 6px rgba(0,0,0,0.05);
      word-break:break-all; overflow-wrap:break-word;
    }

    #resultGroup { display:none; flex-direction:column; gap:16px; margin-top:10px; }
    .result-card {
      background:var(--card-bg); border:1px solid var(--border); border-radius:var(--radius);
      padding:16px; box-shadow:var(--shadow);
    }
    .label {
      font-weight:600; margin-bottom:6px; font-size:1.05rem;
    }
    .result-url {
      font-family:'SF Mono',Monaco,'Courier New',monospace; color:#d63384;
      word-break:break-all; white-space:pre-wrap; margin-bottom:8px; font-size:0.95rem; line-height:1.5;
    }
    .hint {
      font-size:0.9rem; color:var(--text-light); margin-bottom:10px;
    }
    .copy-btn {
      background:var(--primary); color:white; border:none; padding:6px 12px;
      font-size:0.9rem; border-radius:8px; cursor:pointer; transition:var(--transition);
    }
    .copy-btn.warn { background:#ffa500; }
    .copy-btn:active { transform:scale(0.96); }

    .buttons { display:flex; gap:12px; margin-top:10px; }
    button {
      flex:1; padding:14px 0; font-size:1rem; font-weight:500; border:none;
      border-radius:var(--radius); cursor:pointer; transition:var(--transition);
      box-shadow:0 1px 4px rgba(0,0,0,0.1);
    }
    button:active { transform:scale(0.98); }
    #convert { background-color:var(--primary); color:white; }
    #actionBtn { background-color:var(--border); color:var(--text); }
    footer {
      margin-top:40px; text-align:center; font-size:0.85rem; color:var(--text-light); padding-bottom:30px;
    }
    button:hover:not(:active) { opacity:0.92; }
  </style>
</body>
</html>